services:
    frontend:
        build:
            context: .
            dockerfile: Dockerfile.prod
        container_name: portfolio
        working_dir: /app
        ports:
            - "3000"
        environment:
            - NODE_ENV=production
            - NEXT_PUBLIC_APP_URL=${NEXT_PUBLIC_APP_URL}
            - NEXT_PUBLIC_EMAIL=${NEXT_PUBLIC_EMAIL}
            - NEXT_PUBLIC_SANITY_PROJECT_ID=${NEXT_PUBLIC_SANITY_PROJECT_ID}
            - NEXT_PUBLIC_SANITY_DATASET=${NEXT_PUBLIC_SANITY_DATASET}
            - NEXT_PUBLIC_SANITY_API_VERSION=${NEXT_PUBLIC_SANITY_API_VERSION}
        command: ["npm", "start"]
        networks:
            - traefik-public
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.portfolio.rule=Host(`piedanna.dev`)"
            - "traefik.http.routers.portfolio.entrypoints=websecure"
            - "traefik.http.routers.portfolio.tls.certresolver=letsencrypt"
            - "traefik.http.services.portfolio.loadbalancer.server.port=3000"
            - "traefik.docker.network=traefik-public"

networks:
    traefik-public:
        external: true